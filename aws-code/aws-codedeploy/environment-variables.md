# Environment Variables

## AWS Doc

[https://aws.amazon.com/blogs/devops/using-codedeploy-environment-variables/](https://aws.amazon.com/blogs/devops/using-codedeploy-environment-variables/)

\
Customers have been asking for a way to provide context information on the deployment that can be used by the scripts. AWS CodeDeploy environment variables let you do just that.

<pre data-overflow="wrap" data-line-numbers><code>LIFECYCLE_EVENT : This variable contains the name of the lifecycle event associated with the script.
DEPLOYMENT_ID :  This variables contains the deployment ID of the current deployment.
APPLICATION_NAME :  This variable contains the name of the application being deployed. This is the name the user sets in the console or AWS CLI.
DEPLOYMENT_GROUP_NAME :  This variable contains the name of the deployment group. A deployment group is a set of instances associated with an application that you target for a deployment.
<strong>DEPLOYMENT_GROUP_ID : This variable contains the ID of the deployment group in AWS CodeDeploy that corresponds to the current deployment
</strong></code></pre>

## Env Vars

### **DEPLOYMENT\_GROUP\_NAME**

```
if [ "$DEPLOYMENT_GROUP_NAME" == "Staging" ]
then
    sed -i -e 's/LogLevel warn/LogLevel debug/g' /etc/httpd/conf/httpd.conf
fi
```

### **APPLICATION\_NAME**

```
#!/usr/bin/python

import os

strToSearch="<h2>This application was deployed using AWS CodeDeploy.</h2>"

strToReplace="<h2>This page for " + os.environ['APPLICATION_NAME'] + " application and " + os.environ['DEPLOYMENT_GROUP_NAME'] + " deployment group with " + os.environ['DEPLOYMENT_GROUP_ID'] +  "deployment group id was generated by a " + os.environ['LIFECYCLE_EVENT'] + " script during " + os.environ['DEPLOYMENT_ID'] + " deployment.</h2>"

fp=open("/var/www/html/index.html","r")
buffer=fp.read()
fp.close()

fp=open("/var/www/html/index.html","w")
fp.write(buffer.replace(strToSearch,strToReplace))
fp.close()
```

## appspec.yml

The `appspec.yml` file is a configuration file used by AWS CodeDeploy to manage a deployment. It acts as a blueprint, providing instructions to CodeDeploy on which files to deploy, where to place them, and what scripts to execute at different points during the deployment lifecycle. The file is written in YAML or JSON format and must be placed in the root directory of your application's source code. Its structure and content vary depending on the target compute platform (e.g., EC2/on-premises, AWS Lambda, or Amazon ECS).&#x20;

### Common elements

* `version`: Specifies the version of the AppSpec file format.
* `os`: Specifies the operating system of the target instances, such as `linux` or `windows`. This is for EC2/on-premises deployments.
* `files`: Defines the source files from your application revision and their destination on the target instances. This is used for EC2/on-premises deployments.
* `hooks`: Specifies scripts or functions to run during specific stages of the deployment lifecycle. These "hooks" allow for custom actions before, during, and after the core deployment.&#x20;

### Example

```yaml
version: 0.0
os: linux
files:
  - source: /index.html
    destination: /var/www/html/
hooks:
  BeforeInstall:
    - location: scripts/install_dependencies
      timeout: 300
      runas: root
    - location: scripts/start_server
      timeout: 300
      runas: root
  ApplicationStop:
    - location: scripts/stop_server
      timeout: 300
      runas: root
```
